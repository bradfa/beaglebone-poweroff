+static void am335x_bone_poweroff(void)
+{
+	void __iomem *base;
+	long seconds;
+
+	base = ioremap(AM33XX_RTC_BASE, SZ_4K);
+
+	if (WARN_ON(!base))
+		return; /*-ENOMEM;*/
+
+	/* Enable pwr_enable_en */
+	writel(0x00010000, base + 0x98);
+	/* Enable ALARM2 INT */
+	writel(0x00000010, base + 0x48);
+
+	/* Copy over RTC time registers */
+	while(1) {
+		printk(KERN_INFO "Turning off power!\n");
+		writel(readl(base+0x04), base + 0x84);
+		writel(readl(base+0x08), base + 0x88);
+		writel(readl(base+0x0C), base + 0x8C);
+		writel(readl(base+0x10), base + 0x90);
+		writel(readl(base+0x14), base + 0x94);
+		seconds = readl(base+0x00);
+		seconds++;
+		writel(seconds, base + 0x80);
+		msleep(1000); /* If we missed the second roll-over, try again */
+	}
+
+	/* Nothing beyond here should ever execute, power should be off */
+	iounmap(base);
+}
+
 static void __init am335x_evm_init(void)
 {
+	pm_power_off = am335x_bone_poweroff;
 	am33xx_cpuidle_init();
 	am33xx_mux_init(board_mux);
 	omap_serial_init();
-- 
1.7.2.5

